(()=>{function e(e,n,t={}){document.getElementById("geminify-box")?.remove();const o=e.getBoundingClientRect(),i=o.top+e.clientHeight+16,r=document.createElement("div");r.id="geminify-box",r.style.position="absolute",r.style.left=`${o.left+window.scrollX}px`,r.style.width=`${e.clientWidth}px`,i+224<window.innerHeight?r.style.top=`${i}px`:r.style.bottom="16px",r.style.maxHeight="224px";const c=document.createElement("h6");c.innerText="Geminify's Suggestion",r.appendChild(c);const a=document.createElement("p");if(a.style.margin="2px 0 !important",a.innerText=n,r.appendChild(a),t.onCopy){const e=document.createElement("div");r.appendChild(e);const t=document.createElement("button");t.innerText="Copy",e.appendChild(t),t.addEventListener("click",(()=>{navigator.clipboard.writeText(n),t.innerText="Copied!"}))}document.body.appendChild(r),r.focus()}chrome.runtime.onMessage.addListener(((n,t,o)=>{if("refineText"===n.action){const t=document.activeElement;!function(){if(document.getElementById("geminify-styles"))return;const e=document.createElement("style");e.id="geminify-styles",e.innerHTML="\n    #geminify-box {\n      color: #333333;\n      background-color: #FFFFFF;\n      border: 1px solid #DDDDDD;\n      border-radius: 12px;\n      box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);\n      font-size: 16px;\n      line-height: 1.5;\n      padding: 12px 16px;\n      position: absolute;\n      z-index: 2147483647;\n      overflow: auto;\n    }\n\n    #geminify-box h6 {\n      color: #4896bf;\n      margin: 0 0 8px;\n    }\n\n    #geminify-box p {\n      color: inherit;\n      margin: 0 !important;\n    }\n\n    #geminify-box button {\n      margin-top: 4px;\n      padding: 4px 8px;\n      color: #4896bf;\n      background-color: #FFFFFF;\n      border: 1px solid #4896bf;\n      border-radius: 8px;\n      cursor: pointer;\n      font-size: 16px;\n      line-height: 1.5;\n      transition: background-color 0.2s;\n    }\n\n    #geminify-box button:hover {\n      color: #ac48bf;\n      border-color: #ac48bf;\n    }\n\n    #geminify-box button:active {\n      color: #ac48bf;\n      border-color: #ac48bf;\n    }\n\n    #geminify-box button:focus {\n      outline: none;\n    }\n\n    #geminify-box > div {\n      margin-top: 4px;\n      text-align: right;\n    }\n  ",document.head.appendChild(e)}(),e(t,"Refining the text..."),chrome.storage.sync.get("googleApiKey",(({googleApiKey:o})=>{if(!o)return void(box.innerText="Please set your Geminify API key in the extension options.");const i={contents:[{parts:[{text:`\n        You're a Grammer Wizard! You will refine the text provided below.\n        Don't change the text, tone or meaning. Just make it better and grammatically correct.\n        If you're unsure or can't improve it, return the same text.\n\n        Text:\n        ${n.text.trim()}\n      `}]}]};fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${o}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then((e=>e.json())).then((n=>{let o=n?.candidates[0]?.content?.parts[0]?.text||"No response from the Gemini model.";e(t,o,{onCopy:!0})})).catch((n=>{e(t,"Error occurred while refining the text.")}))}))}})),document.addEventListener("click",(e=>{const n=document.getElementById("geminify-box");n&&!n.contains(e.target)&&n.remove()}))})();