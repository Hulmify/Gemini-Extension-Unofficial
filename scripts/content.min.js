chrome.runtime.onMessage.addListener(((e,t,n)=>{if("refineText"===e.action){const t=document.activeElement,n=t.getBoundingClientRect(),o=document.createElement("div");o.id="geminify-box",o.style.position="absolute",o.style.top=`${n.top+window.scrollY+t.clientHeight+16}px`,o.style.left=`${n.left+window.scrollX}px`,o.style.width=`${t.clientWidth}px`,o.style.backgroundColor="#ffffff",o.style.color="#333333",o.style.padding="12px 16px",o.style.borderRadius="12px",o.style.zIndex="9999",o.style.boxShadow="0px 4px 12px rgba(0, 0, 0, 0.1)",o.style.fontSize="16px",o.style.lineHeight="1.5",o.style.border="1px solid #dddddd",document.body.appendChild(o),o.innerHTML='<p style="margin: 2px !important;">Refining the text...</p>',chrome.storage.sync.get("googleApiKey",(({googleApiKey:t})=>{if(!t)return void(o.innerText="Please set your Geminify API key in the extension options.");const n={contents:[{parts:[{text:`\n        You're a Grammer Wizard! You will refine the text provided below.\n        Don't change the text, tone or meaning. Just make it better and grammatically correct.\n        If you're unsure, you can leave it as it is.\n\n        Text:\n        ${e.text.trim()}\n      `}]}]};fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.json())).then((e=>{o.innerHTML="";let t=e?.candidates[0]?.content?.parts[0]?.text||"No response from the Gemini model.";const n=document.createElement("p");n.style.margin="2px 0 !important",n.innerText=t,o.appendChild(n);const i=document.createElement("button");i.innerText="Copy",i.style.marginTop="4px",i.style.padding="4px 8px",i.style.color="#333333",i.style.backgroundColor="#FFFFFF",i.style.border="1px solid #333333",i.style.borderRadius="8px",i.style.cursor="pointer",i.style.fontSize="16px",i.style.lineHeight="1.5",i.style.transition="background-color 0.2s",i.style.width="100%",o.appendChild(i),i.addEventListener("click",(()=>{navigator.clipboard.writeText(t),i.innerText="Copied!"}))})).catch((e=>{o.innerText="An error occurred while refining the text."}))})),o.focus()}})),document.addEventListener("click",(e=>{const t=document.getElementById("geminify-box");t&&!t.contains(e.target)&&t.remove()}));